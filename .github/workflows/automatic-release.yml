---
name: "tagged-release"

on:
  push:
    tags:
      - "v*"

jobs:
  tagged-release:
    name: "Tagged Release"
    runs-on: "ubuntu-latest"

    steps:
      # ...
      - name: Set up Git repository
        uses: actions/checkout@v2

      - name: Install LaTex
        run: sudo apt-get install texlive texlive-latex-recommended texlive-latex-extra latexmk

      - name: Copy texmf
        run: cp -r texmf "$HOME"

      - name: Setup environment variable
        run: |
          source "$GITHUB_WORKSPACE/.envrc"
          echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
          echo "TEXMFHOME: $TEXMFHOME"
          echo "TEXMFHOME=$TEXMFHOME" >> $GITHUB_ENV

      - name: Compile LaTex document
        run: |
          echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
          echo "TEXMFHOME: $TEXMFHOME"
          make all

      - name: Copy PDF Document
        run: cp 'build/main.pdf' 'Paro_Davide.pdf'

      - name: Generate automatic release with assets
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          draft: False
          prerelease: False
          files: |
            LICENSE
            Paro_Davide.pdf
